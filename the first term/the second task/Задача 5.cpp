#include <iostream>
#include <cmath>
#include <fstream>
using namespace std;

double dxdt(double u){
    return u;
}

double dudt(double x, double y, double nu, double mu, double eta){
    return x + 2 * nu - eta * (x + mu) / sqrt(pow(pow((x + mu), 2) + pow(y,2), 3)) - mu * (x - eta) / sqrt(pow(pow((x - eta), 2) + pow(y,2), 3));
}

double dydt(double nu){
    return nu;
}

double dnudt(double x, double y, double u, double mu, double eta){
    return y - 2 * u - eta * y / sqrt(pow(pow((x + mu), 2) + pow(y,2), 3)) - mu * y / sqrt(pow(pow((x - eta), 2) + pow(y,2), 3));
}

int main() {
    double mu = 0.012, eta = 1 - mu, T = 17.065, t = 100 * T, x_0 = 0.994, y_0 = 0, u_0 = 0, nu_0 = -2.0015851063790825;
    double x, y, u, nu, tau;
    double k1[4], k2[4], k3[4], k4[4], k5[4], k6[4], k7[4], x0, y0, u0, nu0, epsilon;
    int N;

    ofstream f1("x.csv", ios::out);
    ofstream f2("y.csv", ios::out);

    tau = 0.001;
    N = int(t / tau);
    x = x_0;
    y = y_0;
    f1 << x << endl;
    f2 << y << endl;
    u = u_0;
    nu = nu_0;
    cin >> epsilon;
    for (int i = 1; i <= N; i++) {
        x0 = x;
        y0 = y;
        u0 = u;
        nu0 = nu;

        k1[0] = dxdt(u0);
        k1[1] = dydt(nu0);
        k1[2] = dudt(x0, y0, nu0, mu, eta);
        k1[3] = dnudt(x0, y0, u0, mu, eta);

        k2[0] = dxdt(u0 + tau * (0.2 * k1[2]));
        k2[1] = dydt(nu0 + tau * (0.2 * k1[3]));
        k2[2] = dudt(x0 + tau * (0.2 * k1[0]), y0 + tau * (0.2 * k1[1]), nu0 + tau * (0.2 * k1[3]), mu, eta);
        k2[3] = dnudt(x0 + tau * (0.2 * k1[0]), y0 + tau * (0.2 * k1[1]), u0 + tau * (0.2 * k1[2]), mu, eta);

        k3[0] = dxdt(u0 + tau * ((3.0 / 40.0) * k1[2] + (9.0 / 40.0) * k2[2]));
        k3[1] = dydt(nu0 + tau * ((3.0 / 40.0) * k1[3] + (9.0 / 40.0) * k2[3]));
        k3[2] = dudt(x0 + tau * ((3.0 / 40.0) * k1[0] + (9.0 / 40.0) * k2[0]), y0 + tau * ((3.0 / 40.0) * k1[1] + (9.0 / 40.0) * k2[1]), nu0 + tau * ((3.0 / 40.0) * k1[3] + (9.0 / 40.0) * k2[3]), mu, eta);
        k3[3] = dnudt(x0 + tau * ((3.0 / 40.0) * k1[0] + (9.0 / 40.0) * k2[0]), y0 + tau * ((3.0 / 40.0) * k1[1] + (9.0 / 40.0) * k2[1]), u0 + tau * ((3.0 / 40.0) * k1[2] + (9.0 / 40.0) * k2[2]), mu, eta);

        k4[0] = dxdt(u0 + tau * ((44.0 / 45.0) * k1[2] + (-56.0 / 15.0) * k2[2] + (32.0 / 9.0) * k3[2]));
        k4[1] = dydt(nu0 + tau * ((44.0 / 45.0) * k1[3] + (-56.0 / 15.0) * k2[3] + (32.0 / 9.0) * k3[3]));
        k4[2] = dudt(x0 + tau * ((44.0 / 45.0) * k1[0] + (-56.0 / 15.0) * k2[0] + (32.0 / 9.0) * k3[0]), y0 + tau * ((44.0 / 45.0) * k1[1] + (-56.0 / 15.0) * k2[1] + (32.0 / 9.0) * k3[1]), nu0 + tau * ((44.0 / 45.0) * k1[3] + (-56.0 / 15.0) * k2[3] + (32.0 / 9.0) * k3[3]), mu, eta);
        k4[3] = dnudt(x0 + tau * ((44.0 / 45.0) * k1[0] + (-56.0 / 15.0) * k2[0] + (32.0 / 9.0) * k3[0]), y0 + tau * ((44.0 / 45.0) * k1[1] + (-56.0 / 15.0) * k2[1] + (32.0 / 9.0) * k3[1]), u0 + tau * ((44.0 / 45.0) * k1[2] + (-56.0 / 15.0) * k2[2] + (32.0 / 9.0) * k3[2]), mu, eta);

        k5[0] = dxdt(u0 + tau * ((19372.0 / 6561.0) * k1[2] + (-25360.0 / 2187.0) * k2[2] + (64448.0 / 6561.0) * k3[2] + (-212.0 / 729.0) * k4[2]));
        k5[1] = dydt(nu0 + tau * ((19372.0 / 6561.0) * k1[3] + (-25360.0 / 2187.0) * k2[3] + (64448.0 / 6561.0) * k3[3] + (-212.0 / 729.0) * k4[3]));
        k5[2] = dudt(x0 + tau * ((19372.0 / 6561.0) * k1[0] + (-25360.0 / 2187.0) * k2[0] + (64448.0 / 6561.0) * k3[0] + (-212.0 / 729.0) * k4[0]), y0 + tau * ((19372.0 / 6561.0) * k1[1] + (-25360.0 / 2187.0) * k2[1] + (64448.0 / 6561.0) * k3[1] + (-212.0 / 729.0) * k4[1]), nu0 + tau * ((19372.0 / 6561.0) * k1[3] + (-25360.0 / 2187.0) * k2[3] + (64448.0 / 6561.0) * k3[3] + (-212.0 / 729.0) * k4[3]), mu, eta);
        k5[3] = dnudt(x0 + tau * ((19372.0 / 6561.0) * k1[0] + (-25360.0 / 2187.0) * k2[0] + (64448.0 / 6561.0) * k3[0] + (-212.0 / 729.0) * k4[0]), y0 + tau * ((19372.0 / 6561.0) * k1[1] + (-25360.0 / 2187.0) * k2[1] + (64448.0 / 6561.0) * k3[1] + (-212.0 / 729.0) * k4[1]), u0 + tau * ((19372.0 / 6561.0) * k1[2] + (-25360.0 / 2187.0) * k2[2] + (64448.0 / 6561.0) * k3[2] + (-212.0 / 729.0) * k4[2]), mu, eta);

        k6[0] = dxdt(u0 + tau * ((9017.0 / 3168.0) * k1[2] + (-355.0 / 33.0) * k2[2] + (46732.0 / 5247.0) * k3[2] + (49.0 / 176.0) * k4[2] + (-5103.0 / 18656.0) * k5[2]));
        k6[1] = dydt(nu0 + tau * ((9017.0 / 3168.0) * k1[3] + (-355.0 / 33.0) * k2[3] + (46732.0 / 5247.0) * k3[3] + (49.0 / 176.0) * k4[3] + (-5103.0 / 18656.0) * k5[3]));
        k6[2] = dudt(x0 + tau * ((9017.0 / 3168.0) * k1[0] + (-355.0 / 33.0) * k2[0] + (46732.0 / 5247.0) * k3[0] + (49.0 / 176.0) * k4[0] + (-5103.0 / 18656.0) * k5[0]), y0 + tau * ((9017.0 / 3168.0) * k1[1] + (-355.0 / 33.0) * k2[1] + (46732.0 / 5247.0) * k3[1] + (49.0 / 176.0) * k4[1] + (-5103.0 / 18656.0) * k5[1]), nu0 + tau * ((9017.0 / 3168.0) * k1[3] + (-355.0 / 33.0) * k2[3] + (46732.0 / 5247.0) * k3[3] + (49.0 / 176.0) * k4[3] + (-5103.0 / 18656.0) * k5[3]), mu, eta);
        k6[3] = dnudt(x0 + tau * ((9017.0 / 3168.0) * k1[0] + (-355.0 / 33.0) * k2[0] + (46732.0 / 5247.0) * k3[0] + (49.0 / 176.0) * k4[0] + (-5103.0 / 18656.0) * k5[0]), y0 + tau * ((9017.0 / 3168.0) * k1[1] + (-355.0 / 33.0) * k2[1] + (46732.0 / 5247.0) * k3[1] + (49.0 / 176.0) * k4[1] + (-5103.0 / 18656.0) * k5[1]), u0 + tau * ((9017.0 / 3168.0) * k1[2] + (-355.0 / 33.0) * k2[2] + (46732.0 / 5247.0) * k3[2] + (49.0 / 176.0) * k4[2] + (-5103.0 / 18656.0) * k5[2]), mu, eta);

        k7[0] = dxdt(u0 + tau * ((35.0 / 384.0) * k1[2] + (500.0 / 1113.0) * k3[2] + (125.0 / 192.0) * k4[2] + (-2187.0 / 6784.0) * k5[2] + (11.0 / 84.0) * k6[2]));
        k7[1] = dydt(nu0 + tau * ((35.0 / 384.0) * k1[3] + (500.0 / 1113.0) * k3[3] + (125.0 / 192.0) * k4[3] + (-2187.0 / 6784.0) * k5[3] + (11.0 / 84.0) * k6[3]));
        k7[2] = dudt(x0 + tau * ((35.0 / 384.0) * k1[0] + (500.0 / 1113.0) * k3[0] + (125.0 / 192.0) * k4[0] + (-2187.0 / 6784.0) * k5[0] + (11.0 / 84.0) * k6[0]), y0 + tau * ((35.0 / 384.0) * k1[1] + (500.0 / 1113.0) * k3[1] + (125.0 / 192.0) * k4[1] + (-2187.0 / 6784.0) * k5[1] + (11.0 / 84.0) * k6[1]), nu0 + tau * ((35.0 / 384.0) * k1[3] + (500.0 / 1113.0) * k3[3] + (125.0 / 192.0) * k4[3] + (-2187.0 / 6784.0) * k5[3] + (11.0 / 84.0) * k6[3]), mu, eta);
        k7[3] = dnudt(x0 + tau * ((35.0 / 384.0) * k1[0] + (500.0 / 1113.0) * k3[0] + (125.0 / 192.0) * k4[0] + (-2187.0 / 6784.0) * k5[0] + (11.0 / 84.0) * k6[0]), y0 + tau * ((35.0 / 384.0) * k1[1] + (500.0 / 1113.0) * k3[1] + (125.0 / 192.0) * k4[1] + (-2187.0 / 6784.0) * k5[1] + (11.0 / 84.0) * k6[1]), u0 + tau * ((35.0 / 384.0) * k1[2] + (500.0 / 1113.0) * k3[2] + (125.0 / 192.0) * k4[2] + (-2187.0 / 6784.0) * k5[2] + (11.0 / 84.0) * k6[2]), mu, eta);

        x = x0 + tau * ((35.0 / 384.0) * k1[0] + (500.0 / 1113.0) * k3[0] + (125.0 / 192.0) * k4[0] + (-2187.0 / 6784.0) * k5[0] + (11.0 / 84.0) * k6[0]);
        y = y0 + tau * ((35.0 / 384.0) * k1[1] + (500.0 / 1113.0) * k3[1] + (125.0 / 192.0) * k4[1] + (-2187.0 / 6784.0) * k5[1] + (11.0 / 84.0) * k6[1]);
        u = u0 + tau * ((35.0 / 384.0) * k1[2] + (500.0 / 1113.0) * k3[2] + (125.0 / 192.0) * k4[2] + (-2187.0 / 6784.0) * k5[2] + (11.0 / 84.0) * k6[2]);
        nu = nu0 + tau * ((35.0 / 384.0) * k1[3] + (500.0 / 1113.0) * k3[3] + (125.0 / 192.0) * k4[3] + (-2187.0 / 6784.0) * k5[3] + (11.0 / 84.0) * k6[3]);
        tau *= pow(epsilon * tau / (2 * abs((71.0 / 57600.0) * k1[0] - 71.0 * k3[0] / 16695.0 + 71.0 * k4[0] / 1920.0 - 17253.0 * k5[0] / 339200.0 + 22.0 * k6[0] / 525.0 - 1.0 * k7[0] / 40.0)), 0.2);
        f1 << x << endl;
        f2 << y << endl;
    }
    cout << x << endl;
    cout << y << endl;
    cout << u << endl;
    cout << nu << endl;
    cout << tau << endl;
}
